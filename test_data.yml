test_cases:
  - test_case: defaults_only
    layers: [defaults]
    cli_args: ""
    env_vars: {}
    expected: |
      api:
        rate:
          limit: 100
        timeout: 30
      cache:
        enabled: true
        redis:
          host: localhost
        ttl: 3600
      database:
        max:
          connections: 100
        port: 5432
        url: postgresql://localhost/mydb
      host: localhost
      port: 8080
  - test_case: config_only
    layers: [config]
    cli_args: ""
    env_vars: {}
    expected: |
      api:
        rate:
          limit: 100
        timeout: 30
      cache:
        enabled: true
        redis:
          host: localhost
        ttl: 3600
      database:
        max:
          connections: 100
        port: 5432
        url: postgresql://localhost/mydb
      host: localhost
      port: 8080
  - test_case: cli_only
    layers: [cli]
    cli_args: "--port 9000 --cache.enabled false"
    env_vars: {}
    expected: |
      api:
        rate:
          limit: 100
        timeout: 30
      cache:
        enabled: false
        redis:
          host: localhost
        ttl: 3600
      database:
        max:
          connections: 100
        port: 5432
        url: postgresql://localhost/mydb
      host: localhost
      port: 9000
  - test_case: env_only
    layers: [env]
    cli_args: ""
    env_vars:
      PORT: "5000"
      API__TIMEOUT: "45"
    expected: |
      api:
        rate:
          limit: 100
        timeout: 45
      cache:
        enabled: true
        redis:
          host: localhost
        ttl: 3600
      database:
        max:
          connections: 100
        port: 5432
        url: postgresql://localhost/mydb
      host: localhost
      port: 5000
  - test_case: config_and_cli
    layers: [config, cli]
    cli_args: "--port 9000 --cache.enabled false"
    env_vars: {}
    expected: |
      api:
        rate:
          limit: 100
        timeout: 30
      cache:
        enabled: false
        redis:
          host: localhost
        ttl: 3600
      database:
        max:
          connections: 100
        port: 5432
        url: postgresql://localhost/mydb
      host: localhost
      port: 9000
  - test_case: config_and_env
    layers: [config, env]
    cli_args: ""
    env_vars:
      PORT: "5000"
      API__TIMEOUT: "45"
    expected: |
      api:
        rate:
          limit: 100
        timeout: 45
      cache:
        enabled: true
        redis:
          host: localhost
        ttl: 3600
      database:
        max:
          connections: 100
        port: 5432
        url: postgresql://localhost/mydb
      host: localhost
      port: 5000
  - test_case: cli_and_env
    layers: [cli, env]
    cli_args: "--port 9000 --cache.enabled false"
    env_vars:
      PORT: "5000"
      API__TIMEOUT: "45"
    expected: |
      api:
        rate:
          limit: 100
        timeout: 45
      cache:
        enabled: false
        redis:
          host: localhost
        ttl: 3600
      database:
        max:
          connections: 100
        port: 5432
        url: postgresql://localhost/mydb
      host: localhost
      port: 5000
  - test_case: all_layers
    layers: [config, cli, env]
    cli_args: "--port 9000 --cache.enabled false"
    env_vars:
      PORT: "5000"
      API__TIMEOUT: "45"
    expected: |
      api:
        rate:
          limit: 100
        timeout: 45
      cache:
        enabled: false
        redis:
          host: localhost
        ttl: 3600
      database:
        max:
          connections: 100
        port: 5432
        url: postgresql://localhost/mydb
      host: localhost
      port: 5000